# 优化原则  
1. 不过早优化，当性能成为关键时再优化  
2. 先优化架构、框架、流程、系统配置、设置编译器优化相关参数这些宏观上的东西        
3. 找出性能瓶颈，对热点代码进行优化  
4. 可考虑空间换时间

# 工具  
* perf   

* VTune  
interl程序性能工具。   
https://software.intel.com/en-us/vtune-amplifier-help-amplxe-cl-command-syntax  

# 关键点  
* 内存，包括cache
* 分支预测

# 实操  
此处为一般性优化操作。
## 设计  
* 优先多核，然后多线程
* 数据本地化、无锁化  
## 变量 
* 不同类型声明顺序？
* 同时声明多个同类型的变量  
* 尽量少用全局变量，可先赋值给局部变量再使用  
* 尽量使用const、static（本地化）  
* 少用数组，换成指针  
* 结构体要对齐，使用__attribute__((__aligned__(a)))，根据CPU设置，一般a为64，可通过命令查看，cat /sys/devices/system/cpu/cpu0/cache/index0/coherency_line_size
## 函数及逻辑
* 函数不需要返回值时，用void减少栈操作  
* 函数尽量使用const、static（本地化）、inline及其组合来修饰  
* 条件出现概率可预测时，用 likely、unlikely，否则不用  
* 尽量消除条件分支判断  
* if、switch 分支中，按出现可能性由高到低排放  
* incr i 和 ++i 都优于 i++  
* for (;;)优于while(1)  
* for(;;--i) 比 for(;;i++)指令少几个字节？While 同理。
* 尽量用位运算替换乘除、求模。加法比乘法快  
## 编译相关    
* O3优化  
* 定义函数原型，便于编译器优化  

# 应用  
* DPDK应用程序优化  
